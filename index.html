<!DOCTYPE html>
<html lang="tg">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Tap Car ‚Äì Full Game</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: system-ui;
        }

        body {
            min-height: 100vh;
            background: #020617;
            color: #fff;
            display: flex;
            flex-direction: column;
            align-items: center;
            overflow-x: hidden;
        }

        .balance {
            font-size: 18px;
            font-weight: 700;
            margin: 12px 0;
            text-align: center;
            padding: 6px 14px;
            border-radius: 16px;
            background: linear-gradient(90deg, #22c55e, #16a34a);
            box-shadow: 0 4px 15px rgba(34, 197, 94, .5);
            display: flex;
            gap: 12px;
            justify-content: center;
            align-items: center;
        }

        .screen {
            display: none;
            flex-direction: column;
            align-items: center;
            padding: 16px;
            width: 100%;
            margin-top: 60px;
        }

        .screen.active {
            display: flex;
        }

        .center-wrap {
            position: relative;
            width: 260px;
            height: 260px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-top: 20px;
        }

        .ring {
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            border: 6px solid rgba(34, 197, 94, .25);
            animation: spin 6s linear infinite;
        }

        .ring::after {
            content: "";
            position: absolute;
            inset: 12px;
            border-radius: 50%;
            border: 6px dashed rgba(34, 197, 94, .6);
        }

        .car {
            font-size: 110px;
            z-index: 2;
            cursor: pointer;
            user-select: none;
            transition: .15s;
        }

        .car:active {
            transform: scale(1.15);
        }

        @keyframes spin {
            from {
                transform: rotate(0)
            }

            to {
                transform: rotate(360deg)
            }
        }

        .money-fly {
            position: absolute;
            font-size: 24px;
            animation: flyUp 1s ease-out forwards;
            pointer-events: none;
            text-shadow: 0 0 6px #ffd700, 0 0 12px #ffff00;
        }

        @keyframes flyUp {
            0% {
                opacity: 1;
                transform: translateY(0) scale(1)
            }

            100% {
                opacity: 0;
                transform: translateY(-100px) scale(1.3);
            }
        }

        .ham-card,
        .ref-card {
            width: 100%;
            max-width: 420px;
            background: linear-gradient(180deg, #0f172a, #020617);
            border-radius: 22px;
            padding: 18px;
            margin: 10px 0;
            box-shadow: 0 20px 40px rgba(0, 0, 0, .6);
            transition: transform .3s;
        }

        .ham-card:hover,
        .ref-card:hover {
            transform: scale(1.02);
            box-shadow: 0 0 30px rgba(34, 197, 94, .6);
        }

        .ham-top {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 10px;
        }

        .ham-icon {
            width: 52px;
            height: 52px;
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #22c55e;
        }

        .ham-title {
            font-size: 18px;
            font-weight: 700;
        }

        .ham-reward {
            font-size: 14px;
            opacity: .8;
        }

        .box-row {
            display: flex;
            gap: 12px;
            margin-top: 16px;
        }

        .box {
            flex: 1;
            padding: 20px;
            background: #229ed9;
            border-radius: 16px;
            text-align: center;
            font-size: 24px;
            cursor: pointer;
            transition: .2s;
        }

        .box:hover {
            transform: scale(1.05);
            background: #00ff77;
        }

        .social-btn {
            flex: 1;
            padding: 14px;
            border: none;
            border-radius: 16px;
            font-size: 15px;
            font-weight: 700;
            color: #fff;
            cursor: pointer;
            transition: .3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            background: #229ed9;
        }

        .social-btn:hover {
            background: #22c55e;
            transform: scale(1.05);
            box-shadow: 0 0 12px #22c55e;
        }

        .progress {
            width: 100%;
            height: 10px;
            background: #1e293b;
            border-radius: 10px;
            overflow: hidden;
            margin-top: 10px;
        }

        .progress span {
            display: block;
            height: 100%;
            width: 0%;
            background: linear-gradient(90deg, #22c55e, #16a34a);
            transition: .3s;
        }

        .glow {
            box-shadow: 0 0 20px rgba(34, 197, 94, .6);
        }

        .ref-card input {
            width: 100%;
            padding: 10px;
            border-radius: 10px;
            border: none;
            margin-bottom: 10px;
            background: #1e293b;
            color: #fff;
            font-size: 14px;
        }

        .ref-card button {
            width: 100%;
            padding: 14px;
            border-radius: 16px;
            border: none;
            background: #229ed9;
            color: #fff;
            font-weight: 700;
            font-size: 15px;
            cursor: pointer;
            transition: .3s;
        }

        .ref-card button:hover {
            transform: scale(1.05);
            box-shadow: 0 0 12px #22c55e;
        }

        .menu {
            position: fixed;
            bottom: 20px;
            display: flex;
            gap: 12px;
            width: 90%;
            max-width: 400px;
            justify-content: space-between;
            z-index: 10;
        }

        .menu button {
            flex: 1;
            background: none;
            border: none;
            color: #94a3b8;
            font-size: 16px;
            padding: 12px;
            border-radius: 12px;
            background: rgba(30, 41, 59, 0.8);
        }

        .menu button.active {
            color: #22c55e;
            background: rgba(34, 197, 94, 0.2);
        }

        .top-box {
            width: 100%;
            max-width: 400px;
            background: #1e293b;
            border-radius: 16px;
            padding: 16px;
        }

        .top-box ol {
            padding-left: 20px;
            color: #fff;
            text-align: left;
        }

        button.energy-btn {
            padding: 14px 20px;
            font-size: 16px;
            border-radius: 12px;
            border: none;
            background: #ff9900;
            color: #fff;
            cursor: pointer;
            transition: .3s;
            margin-top: 20px;
        }
    </style>
</head>

<body>

    <!-- BALANCE -->
    <div class="balance" id="balance">
        üí∞ <span id="money">0</span> | ‚ö° <span id="energy">0</span>
    </div>

    <!-- GAME SCREEN -->
    <div class="screen active" id="game">
        <div class="center-wrap">
            <div class="ring"></div>
            <div class="car" id="car">üöó</div>
        </div>
        <div style="opacity:.7;margin-top:10px;">–¢–∞–ø –∫—É–Ω ‚Üí –ø—É–ª –≥–∏—Ä</div>
        <button id="energyBtn" class="energy-btn">‚ö° –≠–Ω–µ—Ä–≥–∏—è +1</button>
    </div>

    <!-- TOP SCREEN -->
    <div class="screen" id="top">
        <h1 style="color:#22c55e;text-align:center;margin-bottom:20px;">üèÜ Top —Ä–µ–π—Ç–∏–Ω–≥</h1>
        <div class="top-box">
            <ol id="topList"></ol>
        </div>
    </div>

    <!-- BONUS SCREEN -->
    <div class="screen" id="bonus">
        <div class="ham-card">
            <div class="ham-top">
                <div class="ham-icon">üé≤</div>
                <div>
                    <div class="ham-title">–ë–æ–Ω—É—Å–∏ “≤–∞—Ä—Ä”Ø–∑–∞</div>
                    <div class="ham-reward">–Ø–∫ —Ö–æ–Ω–∞—á–∞ –∏–Ω—Ç–∏—Ö–æ–± –∫—É–Ω–µ–¥, –∫–∏ 500 –ú–æ–Ω–µ—Ç–∞ –±—É—Ä–¥–µ–¥! (–Ø–∫ –±–æ—Ä –¥–∞—Ä —è–∫ —Ä”Ø–∑)</div>
                </div>
            </div>
            <div class="box-row" id="boxRow">
                <div class="box" onclick="pickBox(0)">‚ùì</div>
                <div class="box" onclick="pickBox(1)">‚ùì</div>
                <div class="box" onclick="pickBox(2)">‚ùì</div>
            </div>
        </div>

        <div class="ham-card">
            <div class="ham-top">
                <div class="ham-icon">üéÅ</div>
                <div>
                    <div class="ham-title">–ë–æ–Ω—É—Å–∏ –°–æ—Ü–∏–∞–ª”£</div>
                    <div class="ham-reward">–ë–∞—Ä–æ–¥–∞—Ä –ö–∞—Ä–≥–æ + Instagram (24 —Å–æ–∞—Ç)</div>
                </div>
            </div>
            <div class="progress"><span id="socialProg"></span></div>
            <div class="box-row">
                <button class="social-btn" onclick="tgBonus()">üì¢ –ë–∞—Ä–æ–¥–∞—Ä –ö–∞—Ä–≥–æ</button>
                <button class="social-btn" onclick="igBonus()">üì∏ Instagram</button>
            </div>
        </div>

        <div class="ref-card">
            <div class="ham-top">
                <div class="ham-icon">üë•</div>
                <div>
                    <div class="ham-title">–†–µ—Ñ–µ—Ä–∞–ª</div>
                    <div class="ham-reward">+500 –ú–æ–Ω–µ—Ç–∞ –±–∞—Ä–æ–∏ “≥–∞—Ä –¥”Ø—Å—Ç</div>
                </div>
            </div>
            <input id="refLink" readonly>
            <button class="social-btn" onclick="copyRef()">üìã –ù—É—Å—Ö–∞ –≥–∏—Ä–∏—Ñ—Ç–∞–Ω</button>
        </div>
    </div>

    <!-- MENU -->
    <div class="menu">
        <button class="active" onclick="show('game',this)">üè† –•–æ–Ω–∞</button>
        <button onclick="show('top',this)">üèÜ Top —Ä–µ–π—Ç–∏–Ω–≥</button>
        <button onclick="show('bonus',this)">üéÅ –ë–æ–Ω—É—Å“≥–æ</button>
    </div>

    <script>
        const tg = (window.Telegram && Telegram.WebApp) ? Telegram.WebApp : { expand: () => { }, initDataUnsafe: {} };
        tg.expand();

        // ======== –î–ê–ù–ù–´–ï –ò LOCALSTORAGE ========
        if (!localStorage.uid) localStorage.uid = Math.floor(Math.random() * 999999);
        let uid = localStorage.uid;
        let money = +localStorage.money || 0;
        let energy = +localStorage.energy || 0;
        let lastDaily = +localStorage.lastDaily || 0;
        let lastTg = +localStorage.tgTime || 0;
        let lastIg = +localStorage.igTime || 0;
        let lastRestore = +localStorage.lastRestore || Date.now();
        const maxEnergy = 10;
        const restoreTime = 30; // —Å–µ–∫
        const USER_NAME = tg.initDataUnsafe?.user?.first_name || "–ë–æ–∑–∏–≥–∞—Ä";
        const ref = "https://tapcar.fake/ref?uid=" + uid;

        const $ = id => document.getElementById(id);
        if ($("refLink")) $("refLink").value = ref;

        function saveData() {
            localStorage.money = money;
            localStorage.energy = energy;
            localStorage.lastDaily = lastDaily;
            localStorage.tgTime = lastTg;
            localStorage.igTime = lastIg;
            localStorage.lastRestore = lastRestore;
        }

        function update() {
            $("money").innerText = money;
            $("energy").innerText = energy;
            updateTop();
            updateProg();
            saveData();
        }

        // ======== TAP CAR ========
        $("car")?.addEventListener("click", () => {
            if (energy > 0) {
                money += 2;
                energy--;
                animateFly("+2üí∞", $("car"), "#ffff00");
            } else {
                money++;
                animateFly("+1üí∞", $("car"), "#ffeb3b");
            }
            navigator.vibrate?.(10);
            update();
        });

        // ======== ENERGY BUTTON ========
        $("energyBtn")?.addEventListener("click", () => {
            if (energy >= maxEnergy) { alert("‚ö° –≠–Ω–µ—Ä–≥–∏—è —É–∂–µ –ø–æ–ª–Ω–∞—è!"); return; }
            energy++;
            animateFly("+‚ö°1", $("energyBtn"), "#ff9900");
            navigator.vibrate?.(20);
            update();
        });

        // ======== ANIMATION ========
        function animateFly(text, elem, color) {
            const fly = document.createElement("div");
            fly.className = "money-fly";
            fly.innerText = text;
            fly.style.color = color;
            document.body.appendChild(fly);
            const rect = elem.getBoundingClientRect();
            fly.style.left = (rect.left + rect.width / 2 - 20) + "px";
            fly.style.top = (rect.top - 30) + "px";
            setTimeout(() => fly.remove(), 1000);
        }

        // ======== DAILY BONUS ========
        let luckyBox;
        window.pickBox = (i) => {
            if (Date.now() - lastDaily < 86400000) { alert("‚è≥ –ò–º—Ä”Ø–∑ –∞–ª–ª–∞–∫–∞–π –≥–∏—Ä–∏—Ñ—Ç”£ –±–æ–Ω—É—Å–∏ “≥–∞—Ä—Ä”Ø–∑–∞!"); return; }
            if (luckyBox !== undefined) return;
            luckyBox = Math.floor(Math.random() * 3);
            $("boxRow").querySelectorAll(".box").forEach((b, index) => { b.style.background = index === luckyBox ? "#22c55e" : "#334155"; b.innerText = index === luckyBox ? "üí∞" : "‚ùå"; });
            money += (i === luckyBox ? 500 : 200);
            alert(i === luckyBox ? "üéâ –î—É—Ä—É—Å—Ç! +500 –ú–æ–Ω–µ—Ç–∞!" : "üòÖ –ù–æ–¥—É—Ä—É—Å—Ç! –ê–º–º–æ +200 –ú–æ–Ω–µ—Ç–∞!");
            lastDaily = Date.now(); update();
            setTimeout(() => { $("boxRow").querySelectorAll(".box").forEach(b => { b.innerText = "‚ùì"; b.style.background = "#1e293b"; }); luckyBox = undefined; }, 2000);
        }

        // ======== SOCIAL BONUS ========
        window.tgBonus = () => { window.open("https://t.me/barodarcargo", "_blank"); money += 500; lastTg = Date.now(); update(); }
        window.igBonus = () => { window.open("https://www.instagram.com/barodar_cargo", "_blank"); money += 500; lastIg = Date.now(); update(); }

        // ======== PROGRESS BAR ========
        function updateProg() {
            let last = Math.max(lastTg, lastIg);
            let prog = Math.min((Date.now() - last) / 86400000 * 100, 100);
            $("socialProg").style.width = prog + "%";
            $("socialProg").style.transition = "width 1s ease";
            $("socialProg").parentElement.classList.toggle("glow", (Date.now() - last) >= 86400000);
        }
        setInterval(updateProg, 1000);

        // ======== ENERGY RESTORE ========
        function restoreEnergy() {
            const now = Date.now();
            const diff = Math.floor((now - lastRestore) / 1000);
            if (diff >= restoreTime) {
                const add = Math.floor(diff / restoreTime);
                if (energy < maxEnergy) {
                    energy = Math.min(energy + add, maxEnergy);
                    lastRestore = now;
                    update();
                }
            }
        }
        setInterval(restoreEnergy, 1000);

        // ======== REFERRAL ========
        window.copyRef = () => { navigator.clipboard.writeText(ref); alert("üìã –õ–∏–Ω–∫ –Ω—É—Å—Ö–∞ —à—É–¥"); }

        // ======== NAVIGATION ========
        window.show = (id, btn) => {
            document.querySelectorAll(".screen").forEach(s => s.classList.remove("active"));
            document.querySelectorAll(".menu button").forEach(b => b.classList.remove("active"));
            $(id).classList.add("active"); btn.classList.add("active");
            $("balance").style.display = id === "game" ? "flex" : "none";
        }

        // ======== TOP RATING ========
        function updateTop() {
            let topArr = [];
            try { topArr = JSON.parse(localStorage.top || "[]"); } catch (e) { topArr = []; }
            topArr = topArr.filter(u => u.name !== USER_NAME);
            topArr.unshift({ name: USER_NAME, money: money });
            topArr.sort((a, b) => b.money - a.money);
            topArr = topArr.slice(0, 10);
            localStorage.top = JSON.stringify(topArr);
            $("topList").innerHTML = topArr.map((u, i) => `<li>${i + 1}. ${u.name} ‚Äì ${u.money} –ú–æ–Ω–µ—Ç–∞</li>`).join("");
        }

        update();
    </script>
</body>

</html>
