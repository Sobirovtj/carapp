<!DOCTYPE html>
<html lang="tg">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Tap Car ‚Äì –ë–æ–Ω—É—Å“≥–æ –≤–∞ Top —Ä–µ–π—Ç–∏–Ω–≥</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: system-ui
        }

        body {
            height: 100vh;
            background: #020617;
            color: #fff;
            display: flex;
            flex-direction: column
        }

        .screen {
            flex: 1;
            display: none;
            align-items: center;
            justify-content: flex-start;
            flex-direction: column;
            padding: 16px
        }

        .screen.active {
            display: flex
        }

        .top-rating {
            width: 100%;
            padding: 16px;
            background: #1e293b;
            border-radius: 16px;
            margin-bottom: 16px;
            text-align: center
        }

        .top-rating h1 {
            color: #22c55e;
            font-size: 22px;
            margin-bottom: 12px
        }

        .top-rating ol {
            list-style: decimal;
            padding-left: 20px;
            color: #fff;
            text-align: left
        }

        .balance {
            font-size: 22px;
            font-weight: 700;
            margin-bottom: 10px
        }

        .car {
            font-size: 120px;
            margin: 20px 0;
            user-select: none
        }

        .car:active {
            transform: scale(1.1)
        }

        .ham-card,
        .ref-card {
            width: 100%;
            max-width: 420px;
            background: linear-gradient(180deg, #0f172a, #020617);
            border-radius: 22px;
            padding: 18px;
            margin: 10px 0;
            box-shadow: 0 20px 40px rgba(0, 0, 0, .6);
            animation: pop .35s ease
        }

        @keyframes pop {
            from {
                transform: scale(.9);
                opacity: 0
            }

            to {
                transform: scale(1);
                opacity: 1
            }
        }

        .ham-top {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 10px
        }

        .ham-icon {
            width: 52px;
            height: 52px;
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #22c55e
        }

        .ham-title {
            font-size: 18px;
            font-weight: 700
        }

        .ham-reward {
            font-size: 14px;
            opacity: .8
        }

        .social-row {
            display: flex;
            gap: 12px;
            margin-top: 12px
        }

        .social-btn {
            flex: 1;
            padding: 14px;
            border: none;
            border-radius: 16px;
            font-size: 15px;
            font-weight: 700;
            color: #fff;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            cursor: pointer
        }

        .social-btn:active {
            transform: scale(.96)
        }

        .social-tg {
            background: #229ED9
        }

        .social-ig {
            background: linear-gradient(135deg, #ec4899, #f97316)
        }

        .ref-card input {
            width: 100%;
            padding: 10px;
            border-radius: 10px;
            border: none;
            margin-bottom: 10px
        }

        .progress {
            width: 100%;
            height: 10px;
            background: #1e293b;
            border-radius: 10px;
            overflow: hidden;
            margin-top: 10px
        }

        .progress span {
            display: block;
            height: 100%;
            width: 0%;
            background: linear-gradient(90deg, #22c55e, #16a34a);
            transition: .3s
        }

        .glow {
            box-shadow: 0 0 20px rgba(34, 197, 94, .6)
        }

        .box-row {
            display: flex;
            gap: 12px;
            margin-top: 16px
        }

        .box {
            flex: 1;
            padding: 20px;
            background: #1e293b;
            border-radius: 16px;
            text-align: center;
            font-size: 24px;
            cursor: pointer;
            transition: 0.2s
        }

        .box:hover {
            transform: scale(1.05);
            background: #334155
        }

        .menu {
            height: 60px;
            display: flex;
            border-top: 1px solid #334155
        }

        .menu button {
            flex: 1;
            background: none;
            border: none;
            color: #94a3b8;
            font-size: 16px
        }

        .menu button.active {
            color: #22c55e
        }
    </style>
</head>

<body>

    <!-- GAME SCREEN -->
    <div class="screen active" id="game">
        <div class="balance">üí∞ –ë–∞–ª–∞–Ω—Å: <span id="money">0</span>$</div>
        <div class="car" id="car">üöó</div>
        <div style="opacity:.7">–¢–∞–ø –∫—É–Ω ‚Üí –ø—É–ª –≥–∏—Ä</div>
    </div>

    <!-- TOP RATING SCREEN -->
    <div class="screen" id="top">
        <div class="top-rating">
            <h1>üèÜ Top —Ä–µ–π—Ç–∏–Ω–≥</h1>
            <ol id="topList"></ol>
        </div>
    </div>

    <!-- BONUS SCREEN -->
    <div class="screen" id="bonus">
        <!-- DAILY BONUS 3 BOX -->
        <div class="ham-card">
            <div class="ham-top">
                <div class="ham-icon">üé≤</div>
                <div>
                    <div class="ham-title">–ë–æ–Ω—É—Å–∏ “≤–∞—Ä—Ä”Ø–∑–∞</div>
                    <div class="ham-reward">–Ø–∫ —Ö–æ–Ω–∞—á–∞ –∏–Ω—Ç–∏—Ö–æ–± –∫—É–Ω–µ–¥, –∫–∏ 500$ –±—É—Ä–¥–µ–¥! (–Ø–∫ –±–æ—Ä –¥–∞—Ä —è–∫ —Ä”Ø–∑)</div>
                </div>
            </div>
            <div class="box-row" id="boxRow">
                <div class="box" onclick="pickBox(0)">‚ùì</div>
                <div class="box" onclick="pickBox(1)">‚ùì</div>
                <div class="box" onclick="pickBox(2)">‚ùì</div>
            </div>
        </div>

        <!-- SOCIAL BONUS -->
        <div class="ham-card" id="socialCard">
            <div class="ham-top">
                <div class="ham-icon">üéÅ</div>
                <div>
                    <div class="ham-title">–ë–æ–Ω—É—Å–∏ –°–æ—Ü–∏–∞–ª”£</div>
                    <div class="ham-reward">–ë–∞—Ä–æ–¥–∞—Ä –ö–∞—Ä–≥–æ + Instagram (24 —Å–æ–∞—Ç)</div>
                </div>
            </div>
            <div class="progress">
                <span id="socialProg"></span>
            </div>
            <div class="social-row">
                <button class="social-btn social-tg" onclick="tgBonus()">üì¢ –ë–∞—Ä–æ–¥–∞—Ä –ö–∞—Ä–≥–æ</button>
                <button class="social-btn social-ig" onclick="igBonus()">üì∏ Instagram</button>
            </div>
        </div>

        <!-- REFERRAL -->
        <div class="ref-card">
            <div class="ham-top">
                <div class="ham-icon">üë•</div>
                <div>
                    <div class="ham-title">–†–µ—Ñ–µ—Ä–∞–ª</div>
                    <div class="ham-reward">+500$ –±–∞—Ä–æ–∏ “≥–∞—Ä –¥”Ø—Å—Ç</div>
                </div>
            </div>
            <input id="refLink" readonly>
            <button class="social-btn social-tg" onclick="copyRef()">üìã –ù—É—Å—Ö–∞ –≥–∏—Ä–∏—Ñ—Ç–∞–Ω</button>
        </div>
    </div>

    <!-- MENU -->
    <div class="menu">
        <button class="active" onclick="show('game',this)">üè† –•–æ–Ω–∞</button>
        <button onclick="show('top',this)">üèÜ Top —Ä–µ–π—Ç–∏–Ω–≥</button>
        <button onclick="show('bonus',this)">üéÅ –ë–æ–Ω—É—Å“≥–æ</button>
    </div>

    <script>
        const tg = Telegram.WebApp;
        tg.expand();

        let money = +localStorage.money || 0;
        const DAY = 86400000;
        const $ = id => document.getElementById(id);
        // –ò–≤–∞–∑ –∫—É–Ω–µ–¥ –±–æ URL-–∏ —Å–µ—Ä–≤–µ—Ä –æ–Ω–ª–∞–π–Ω (Replit/Render/Railway)
        const SERVER = "https://asset-indexer--domentj.replit.app";

        function update() { $("money").innerText = money; localStorage.money = money; updateTopServer(); }

        /* Tap Car */
        $("car").onclick = () => { money += 1; navigator.vibrate?.(10); update(); }

        /* 3 BOX DAILY BONUS */
        let luckyBox;
        function pickBox(i) {
            let lastDaily = +localStorage.lastDaily || 0;
            if (Date.now() - lastDaily < DAY) { alert("‚è≥ –ò–º—Ä”Ø–∑ –∞–ª–ª–∞–∫–∞–π –≥–∏—Ä–∏—Ñ—Ç”£ –±–æ–Ω—É—Å–∏ “≥–∞—Ä—Ä”Ø–∑–∞!"); return; }
            if (luckyBox === undefined) { luckyBox = Math.floor(Math.random() * 3); }
            $("boxRow").querySelectorAll(".box").forEach((b, index) => {
                b.style.background = index === luckyBox ? "#22c55e" : "#334155";
                b.innerText = index === luckyBox ? "üí∞" : "‚ùå";
            });
            if (i === luckyBox) { money += 500; alert("üéâ –î—É—Ä—É—Å—Ç! +500$!"); }
            else { money += 200; alert("üòÖ –ù–æ–¥—É—Ä—É—Å—Ç! –ê–º–º–æ +200$!"); }
            localStorage.lastDaily = Date.now();
            update();
            luckyBox = undefined;
            setTimeout(() => { $("boxRow").querySelectorAll(".box").forEach(b => { b.innerText = "‚ùì"; b.style.background = "#1e293b" }) }, 2000);
        }

        /* SOCIAL BONUS */
        function tgBonus() { tg.openLink("https://t.me/barodarcargo"); money += 500; localStorage.tgTime = Date.now(); update(); }
        function igBonus() { window.open("https://www.instagram.com/barodar_cargo?igsh=NmhpN2NnN2Fod2Fv", "_blank"); money += 500; localStorage.igTime = Date.now(); update(); }

        /* PROGRESS */
        function updateProg() {
            let last = Math.max(+localStorage.tgTime || 0, +localStorage.igTime || 0);
            let p = Math.min((Date.now() - last) / DAY * 100, 100);
            $("socialProg").style.width = p + "%";
            if (p >= 100) $("socialCard").classList.add("glow"); else $("socialCard").classList.remove("glow");
        }
        setInterval(updateProg, 1000);

        /* REFERRAL */
        let uid = tg.initDataUnsafe?.user?.id || Math.floor(Math.random() * 999999);
        let ref = "https://t.me/barodarcargo?start=" + uid;
        $("refLink").value = ref;
        function copyRef() { navigator.clipboard.writeText(ref); alert("üìã –õ–∏–Ω–∫ –Ω—É—Å—Ö–∞ —à—É–¥"); }

        /* NAV */
        function show(id, btn) { document.querySelectorAll(".screen").forEach(s => s.classList.remove("active")); document.querySelectorAll(".menu button").forEach(b => b.classList.remove("active")); $(id).classList.add("active"); btn.classList.add("active"); }

        /* Top —Ä–µ–π—Ç–∏–Ω–≥ –≤–æ“õ–µ”£ –±–æ —Å–µ—Ä–≤–µ—Ä */
        const USER_NAME = tg.initDataUnsafe?.user?.first_name || "–ë–æ–∑–∏–≥–∞—Ä";

        async function updateTopServer() {
            try {
                await fetch(SERVER + '/top', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ name: USER_NAME, money: money })
                });
                const res = await fetch(SERVER + '/top');
                const top = await res.json();
                let html = '';
                top.forEach(u => { html += `<li>${u.name} ‚Äì ${u.money}$</li>`; });
                $("topList").innerHTML = html;
            } catch (e) { console.error(e); }
        }
        update();
    </script>

</body>

</html>
