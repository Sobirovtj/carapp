<!DOCTYPE html>
<html lang="tg">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Tap Car Online</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins', sans-serif
        }

        body {
            height: 100vh;
            display: flex;
            flex-direction: column;
            background: linear-gradient(135deg, #0f172a, #1e293b);
            color: white;
        }

        .screen {
            flex: 1;
            display: none;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            padding: 20px;
            text-align: center;
        }

        .active {
            display: flex;
        }

        .money {
            font-size: 28px;
            font-weight: 700;
            background: rgba(255, 255, 255, 0.05);
            padding: 10px 20px;
            border-radius: 20px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
            margin-bottom: 20px;
        }

        .car {
            font-size: 120px;
            margin: 20px 0;
            transition: transform 0.1s;
            user-select: none;
        }

        .car:active {
            transform: scale(1.1);
        }

        .btn {
            width: 90%;
            padding: 16px;
            margin: 10px 0;
            font-size: 18px;
            border: none;
            border-radius: 20px;
            font-weight: 700;
            background: linear-gradient(90deg, #22c55e, #16a34a);
            color: black;
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.35);
            transition: transform 0.1s, box-shadow 0.2s;
        }

        .btn:active {
            transform: scale(0.95);
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.35);
        }

        .btn:disabled {
            background: gray;
            color: #ccc;
        }

        .info {
            font-size: 14px;
            opacity: 0.8;
            margin-bottom: 10px;
        }

        .menu {
            height: 70px;
            background: #0f172a;
            display: flex;
            border-top: 2px solid #334155;
            box-shadow: 0 -4px 10px rgba(0, 0, 0, 0.2);
        }

        .menu button {
            flex: 1;
            background: none;
            border: none;
            color: #94a3b8;
            font-size: 14px;
            font-weight: 600;
            transition: color 0.2s;
        }

        .menu button.active {
            color: #22c55e;
            text-shadow: 0 0 10px #22c55e;
        }

        #rating {
            background: rgba(255, 255, 255, 0.05);
            padding: 15px;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
            width: 90%;
            text-align: left;
            margin-top: 20px;
        }

        #rating div {
            padding: 4px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        #rating div:last-child {
            border-bottom: none;
        }
    </style>
</head>

<body>

    <!-- GAME SCREEN -->
    <div class="screen active" id="game">
        <div class="money">üí∞ $<span id="money">0</span></div>
        <div class="car" id="car">üöó</div>
        <div class="info">–¢–∞–ø –∫—É–Ω ‚Üí –ø—É–ª –≥–∏—Ä</div>
    </div>

    <!-- STORE / GARAGE -->
    <div class="screen" id="store">
        <h2>üõí –ì–∞—Ä–∞–∂ / –•–∞–π—Ä–∞</h2>
        <button class="btn" id="engineBtn">
            ‚öôÔ∏è Engine Lv.<span id="engineLv">1</span><br>
            <span class="info">+<span id="tapIncome">1</span>$ / —Ç–∞–ø | –ù–∞—Ä—Ö–∏: <span id="engineCost">50</span></span>
        </button>
        <button class="btn" id="turboBtn">
            üî• Turbo Lv.<span id="turboLv">0</span><br>
            <span class="info">+<span id="passiveIncome">0</span>$ / —Å–µ–∫ | –ù–∞—Ä—Ö–∏: <span id="turboCost">100</span></span>
        </button>
        <button class="btn" id="vehicleBtn">
            üöô –ú–æ—à–∏–Ω –Ω–∞–≤ | –ù–∞—Ä—Ö–∏: <span id="vehicleCost">500</span>
        </button>
    </div>

    <!-- ONLINE TOP RATING -->
    <div class="screen" id="top">
        <h2>üèÜ Top 10 Online</h2>
        <div id="rating"></div>
    </div>

    <!-- BOTTOM MENU -->
    <div class="menu">
        <button class="active" onclick="show('game',this)">üè† –ë–æ–∑”£</button>
        <button onclick="show('top',this)">üèÜ Top</button>
        <button onclick="show('store',this)">üõí –•–∞–π—Ä–∞</button>
    </div>

    <script>
        const tg = Telegram.WebApp;
        tg.expand();

        // GAME DATA
        let money = +localStorage.getItem("money") || 0;
        let engine = +localStorage.getItem("engine") || 1;
        let turbo = +localStorage.getItem("turbo") || 0;
        let vehicles = JSON.parse(localStorage.getItem("vehicles") || '["üöó"]');
        let activeVehicle = vehicles[0];
        let vehicleCost = 500;

        // ELEMENTS
        const $ = id => document.getElementById(id);
        const moneyEl = $("money"), engineLv = $("engineLv"), turboLv = $("turboLv");
        const engineCostEl = $("engineCost"), turboCostEl = $("turboCost"), tapIncomeEl = $("tapIncome"), passiveIncomeEl = $("passiveIncome");
        const vehicleBtn = $("vehicleBtn");
        const ratingEl = $("rating");
        const carEl = $("car");

        // API ENDPOINTS
        const API_URL = "https://yourserver.com"; // –ò–≤–∞–∑ –±–æ —Å–µ—Ä–≤–µ—Ä–∏ –≤–æ“õ–µ”£

        function update() {
            moneyEl.innerText = money;
            engineLv.innerText = engine;
            turboLv.innerText = turbo;
            engineCostEl.innerText = engine * 50;
            turboCostEl.innerText = (turbo + 1) * 100;
            tapIncomeEl.innerText = engine;
            passiveIncomeEl.innerText = turbo;
            vehicleBtn.querySelector("span").innerText = vehicleCost;
            carEl.innerText = activeVehicle;
            localStorage.setItem("money", money);
            localStorage.setItem("engine", engine);
            localStorage.setItem("turbo", turbo);
            localStorage.setItem("vehicles", JSON.stringify(vehicles));
        }
        update();

        // TAP
        carEl.addEventListener("touchstart", () => {
            money += engine;
            if (navigator.vibrate) navigator.vibrate(10);
            update();
            sendScoreToServer();
        });

        // UPGRADES
        engineBtn.onclick = () => { if (money >= engine * 50) { money -= engine * 50; engine++; update(); } };
        turboBtn.onclick = () => { if (money >= (turbo + 1) * 100) { money -= (turbo + 1) * 100; turbo++; update(); } };
        vehicleBtn.onclick = () => { if (money >= vehicleCost) { money -= vehicleCost; let newV = ["üöô", "üèéÔ∏è", "üöì", "üõª"][vehicles.length % 4]; vehicles.push(newV); activeVehicle = newV; vehicleCost = Math.floor(vehicleCost * 1.5); update(); } };

        // PASSIVE INCOME
        setInterval(() => { money += turbo; update(); sendScoreToServer(); }, 1000);

        // NAV
        function show(id, btn) { document.querySelectorAll(".screen").forEach(s => s.classList.remove("active")); document.querySelectorAll(".menu button").forEach(b => b.classList.remove("active")); $(id).classList.add("active"); btn.classList.add("active"); }

        // ONLINE TOP
        async function getTop() {
            try {
                let res = await fetch(`${API_URL}/top`);
                let data = await res.json();
                ratingEl.innerHTML = data.map((d, i) => `${i + 1}. ${d.user} üí∞ ${d.score}`).join("<br>");
            } catch (e) { console.log(e); }
        }

        // SEND SCORE
        async function sendScoreToServer() {
            try {
                let username = tg.initDataUnsafe.user.username || "Guest";
                await fetch(`${API_URL}/score`, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ user: username, score: money })
                });
                getTop();
            } catch (e) { console.log(e); }
        }

        // CALL GET TOP PERIODICALLY
        setInterval(getTop, 5000);
        getTop();

        // DAILY BONUS
        let lastBonus = localStorage.getItem("lastBonus") || 0;
        function dailyBonus() { let now = new Date().getTime(); if (now - lastBonus > 24 * 60 * 60 * 1000) { let bonus = 100 + turbo * 10; money += bonus; lastBonus = now; localStorage.setItem("lastBonus", lastBonus); alert("üéÅ Daily Bonus: +$" + bonus); update(); } }
        dailyBonus();
    </script>
</body>

</html>