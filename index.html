<!DOCTYPE html>
<html lang="tj">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MCOIN Premium 2025</title>

    <!-- SDK –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å Telegram –∏ Firebase -->
    <script src="telegram.org"></script>
    <script src="www.gstatic.com"></script>
    <script src="www.gstatic.com"></script>

    <style>
        :root {
            --primary: #facc15;
            --bg: #050510;
            --card-bg: rgba(255, 255, 255, 0.08);
        }

        * {
            box-sizing: border-box;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            margin: 0;
            background: radial-gradient(circle at center, #1a1a3a 0%, var(--bg) 100%);
            color: #fff;
            font-family: system-ui;
            height: 100vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .header {
            padding: 15px;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            position: absolute;
            top: 0;
            width: 100%;
            z-index: 10;
        }

        .stat-card {
            background: var(--card-bg);
            padding: 10px;
            border-radius: 14px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
        }

        .stat-card span {
            font-size: 10px;
            color: #aaa;
            text-transform: uppercase;
        }

        .stat-card b {
            display: block;
            font-size: 15px;
            color: var(--primary);
        }

        #main-screen {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding-bottom: 60px;
        }

        #balance {
            font-size: 58px;
            font-weight: 900;
            color: var(--primary);
            text-shadow: 0 0 30px rgba(250, 204, 21, 0.4);
            margin-bottom: 5px;
        }

        .coin-wrapper {
            position: relative;
            width: 270px;
            height: 270px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .coin {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: radial-gradient(circle at 30% 30%, #fde047, #ca8a04);
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 130px;
            font-weight: 900;
            color: #000;
            box-shadow: 0 0 60px rgba(250, 204, 21, 0.3);
            cursor: pointer;
            transition: transform 0.05s ease;
        }

        .coin:active {
            transform: scale(0.94);
        }

        .screen {
            display: none;
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--bg);
            padding: 90px 20px 140px 20px;
            z-index: 15;
            overflow-y: auto;
        }

        .footer {
            position: fixed;
            bottom: 0;
            width: 100%;
            background: rgba(5, 5, 16, 0.95);
            backdrop-filter: blur(15px);
            padding: 15px 20px 25px 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.05);
            z-index: 30;
        }

        .nav {
            display: flex;
            justify-content: space-around;
        }

        .nav-item {
            text-align: center;
            color: #555;
            cursor: pointer;
            flex: 1;
        }

        .nav-item.active {
            color: var(--primary);
        }

        .nav-item span {
            display: block;
            font-size: 10px;
            margin-top: 4px;
        }

        /* Styles for Ranking */
        .rank-badge {
            width: 24px;
            height: 24px;
            display: inline-block;
            border-radius: 50%;
            text-align: center;
            line-height: 24px;
            font-weight: bold;
            font-size: 12px;
        }

        .gold {
            background: #ffd700;
            color: #000;
        }

        .silver {
            background: #c0c0c0;
            color: #000;
        }

        .bronze {
            background: #cd7f32;
            color: #000;
        }

        .plus-one {
            position: absolute;
            color: var(--primary);
            font-size: 30px;
            font-weight: 900;
            pointer-events: none;
            animation: floatUp 0.7s ease-out forwards;
            z-index: 100;
        }

        @keyframes floatUp {
            0% {
                transform: translateY(0);
                opacity: 1;
            }

            100% {
                transform: translateY(-130px);
                opacity: 0;
            }
        }
    </style>
</head>

<body>

    <div class="header">
        <div class="stat-card"><span>–§–æ–∏–¥–∞</span><b id="profitHeader">+0</b></div>
        <div class="stat-card"><span>–†–µ–π—Ç–∏–Ω–≥</span><b id="user-rank-pos">...</b></div>
    </div>

    <!-- –û—Å–Ω–æ–≤–Ω–æ–π —ç–∫—Ä–∞–Ω -->
    <div id="main-screen">
        <div id="balance">0</div>
        <div style="color:#666;font-size:14px;letter-spacing:4px;font-weight:900;margin-bottom:30px;">MCOIN</div>
        <div class="coin-wrapper">
            <div class="coin" id="tapBtn">M</div>
        </div>
    </div>

    <!-- –≠–∫—Ä–∞–Ω –†–µ–π—Ç–∏–Ω–≥–∞ -->
    <div id="leaderboard-screen" class="screen">
        <h2 style="color:var(--primary); text-align:center;">üèÜ –¢–æ–ø –ü–µ—à—Å–∞—Ñ–æ–Ω</h2>
        <div style="background: var(--card-bg); border-radius: 20px; padding: 10px;">
            <table style="width: 100%; border-collapse: collapse;">
                <tbody id="leaderboard-list">
                    <!-- –°—é–¥–∞ –ø–æ–ø–∞–¥—É—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ Firebase -->
                </tbody>
            </table>
        </div>
    </div>

    <div class="footer">
        <div class="nav">
            <div class="nav-item active" onclick="showScreen('main')">
                <div style="font-size:20px;">üè†</div><span>–ê—Å–æ—Å”£</span>
            </div>
            <div class="nav-item" onclick="showScreen('rank')">
                <div style="font-size:20px;">üèÜ</div><span>–†–µ–π—Ç–∏–Ω–≥</span>
            </div>
        </div>
    </div>

    <script>
        // 1. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyB8fWEo97uxh755lhEDXpAAf9xwQJJwtkc",
            authDomain: "mcoin-7fd0d.firebaseapp.com",
            projectId: "mcoin-7fd0d",
            storageBucket: "mcoin-7fd0d.firebasestorage.app",
            messagingSenderId: "318917293130",
            appId: "1:318917293130:web:1b37059819fc0a5d0ba2b3"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // 2. –î–∞–Ω–Ω—ã–µ Telegram
        const tg = window.Telegram.WebApp;
        tg.expand();
        const userId = tg.initDataUnsafe.user?.id || "guest";
        const userName = tg.initDataUnsafe.user?.first_name || "–ö–æ—Ä–±–∞—Ä";

        let balance = parseInt(localStorage.getItem('mcoin_bal')) || 0;
        document.getElementById('balance').innerText = balance.toLocaleString();

        // 3. –ö–ª–∏–∫
        const tapBtn = document.getElementById('tapBtn');
        tapBtn.addEventListener('click', (e) => {
            balance++;
            document.getElementById('balance').innerText = balance.toLocaleString();
            localStorage.setItem('mcoin_bal', balance);

            createPlusOne(e.pageX, e.pageY);
            if (balance % 10 === 0) syncData(); // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –æ–±–ª–∞–∫–æ –∫–∞–∂–¥—ã–µ 10 –∫–ª–∏–∫–æ–≤
        });

        function createPlusOne(x, y) {
            const el = document.createElement('div');
            el.className = 'plus-one';
            el.style.left = x + 'px'; el.style.top = y + 'px';
            el.innerText = '+1';
            document.body.appendChild(el);
            setTimeout(() => el.remove(), 700);
        }

        // 4. –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å Firebase
        async function syncData() {
            await db.collection("users").doc(String(userId)).set({
                name: userName,
                balance: balance,
                lastSeen: firebase.firestore.FieldValue.serverTimestamp()
            }, { merge: true });
        }

        // 5. –ó–∞–≥—Ä—É–∑–∫–∞ —Ä–µ–π—Ç–∏–Ω–≥–∞
        async function loadLeaderboard() {
            const list = document.getElementById('leaderboard-list');
            list.innerHTML = '<p style="text-align:center">–ë–æ—Ä–≥–∏—Ä”£...</p>';

            const snapshot = await db.collection("users").orderBy("balance", "desc").limit(15).get();
            list.innerHTML = '';
            let i = 1;
            snapshot.forEach(doc => {
                const data = doc.data();
                const badge = i == 1 ? 'gold' : i == 2 ? 'silver' : i == 3 ? 'bronze' : '';
                list.innerHTML += `
                    <tr style="border-bottom:1px solid rgba(255,255,255,0.05)">
                        <td style="padding:15px"><span class="rank-badge ${badge}">${i}</span></td>
                        <td><b>${data.name}</b></td>
                        <td style="text-align:right; color:var(--primary)">${data.balance.toLocaleString()}</td>
                    </tr>`;
                if (doc.id == userId) document.getElementById('user-rank-pos').innerText = "#" + i;
                i++;
            });
        }

        // 6. –ù–∞–≤–∏–≥–∞—Ü–∏—è
        function showScreen(type) {
            document.querySelectorAll('.screen').forEach(s => s.style.display = 'none');
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));

            if (type === 'rank') {
                document.getElementById('leaderboard-screen').style.display = 'block';
                loadLeaderboard();
                event.currentTarget.classList.add('active');
            } else {
                document.querySelector('.nav-item').classList.add('active');
            }
        }

        // –ü–µ—Ä–≤–∏—á–Ω–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
        syncData();
    </script>
</body>

</html>
